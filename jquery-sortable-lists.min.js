!function(e){e.fn.sortableLists=function(l){var s=e("body").css("position","relative"),t={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(s.css("margin-top")),left:0-parseInt(s.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!1,open:"",close:"",openerCss:{float:"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},maxLevels:!1,listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:!1,scroll:20,ignoreClass:"",isAllowed:function(e,l,s){return!0},onDragStart:function(e,l){return!0},onChange:function(e){return!0},complete:function(e){return!0}},o=e.extend(!0,{},t,l),r=e("<"+o.listSelector+" />").prependTo(s).attr("id","s-l-base").css(o.baseCss).addClass(o.listsClass+" "+o.baseClass),n=e("<li />").attr("id","s-l-placeholder").css(o.placeholderCss).addClass(o.placeholderClass),i=e("<li />").attr("id","s-l-hint").css(o.hintCss).addClass(o.hintClass),a=e("<"+o.listSelector+" />").attr("id","s-l-hint-wrapper").addClass(o.listsClass+" "+o.hintWrapperClass).css(o.listsCss).css(o.hintWrapperCss),c=e("<span />").addClass("s-l-opener "+o.opener.openerClass).css(o.opener.openerCss).on("mousedown",function(l){var s=e(this).closest("li");return s.hasClass("s-l-closed")?E(s):w(s),!1});"class"==o.opener.as?c.addClass(o.opener.close):"html"==o.opener.as?c.html(o.opener.close):console.error("jQuerySortableLists opener as background image has been removed with release 2.0.0. Use html instead please.");var p={isDragged:!1,isRelEFP:null,oEl:null,rootEl:{el:e(this),offset:null,rootElClass:e(this).attr("class")},cEl:null,placeholderParentLi:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},scrollAncestors:[],scrollingEl:e(document.scrollingElement||document.documentElement),doc:e(document),win:e(window)};if(o.opener.active){if(!o.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!o.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";e(this).find("li").each(function(){var l=e(this);l.children(o.listSelector).length&&(c.clone(!0).prependTo(l.children("div").first()),l.hasClass("s-l-open")?E(l):w(l))})}if(!1!==o.maxLevels){if(isNaN(o.maxLevels))throw"JQuery-sortable-lists maxLevels values is not a number";e(this).find("li").each(function(){var l=y(e(this)),s=L(e(this));b(e(this),l),S(e(this),s)})}return this.on("mousedown",function(l){var s=e(l.target);if(!(!1!==p.isDragged||o.ignoreClass&&s.closest("."+o.ignoreClass).length)){l.preventDefault();var t=s.closest("li"),a=e(this);t[0]&&(o.onDragStart(l,t),function(l,s,t){p.isDragged=!0;var a=parseInt(s.css("margin-top")),c=parseInt(s.css("margin-bottom")),h=parseInt(s.css("margin-left")),u=parseInt(s.css("margin-right")),v=s.offset(),g=s.innerHeight();p.rootEl={el:t,offset:t.offset(),rootElClass:t.attr("class")},p.scrollAncestors=e(t.parents(":not(html, body)").filter(function(){return e(this).get(0).scrollHeight>e(this).get(0).clientHeight}).get()),p.cEl={el:s,mT:a,mL:h,mB:c,mR:u,offset:v},p.cEl.xyOffsetDiff={X:l.pageX-p.cEl.offset.left,Y:l.pageY-p.cEl.offset.top},p.cEl.el.addClass("s-l-current "+o.currElClass),s.before(n);var m=p.placeholderNode=e("#s-l-placeholder");s.css({width:s.width(),position:"absolute",top:v.top-a,left:v.left-h}).prependTo(r),m.css({display:"block",height:g}),i.css("height",g),p.doc.on("mousemove",d).on("mouseup",f)}(l,t,a))}});function d(l){if(p.isDragged){var s=p.rootEl.el,t=(p.rootEl.offset,p.scrollAncestors),r=p.scrollingEl,n=p.cEl,i=(p.doc,p.win);l.pageX||function(e){e.pageY=p.pY,e.pageX=p.pX,e.clientY=p.cY,e.clientX=p.cX}(l);var a=s.offset().top+parseInt(s.css("margin-top")),c=s.offset().top+parseInt(s.css("margin-top"))+s.outerHeight(!1),d=t.filter(function(){var s=e(this).offset().top+parseInt(e(this).css("margin-top")),t=s>a;return a=s>a?s:a,l.pageY-a<50&&t}),f=t.filter(function(){var s=e(this).offset().top+parseInt(e(this).css("margin-top"))+e(this).outerHeight(!1),t=s<c;return(c=s<c?s:c)-l.pageY<50&&t});l.clientY<50&&r.scrollTop()>a-10&&(d=d.add(r)),i.height()-l.clientY<50&&r.scrollTop()+i.height()<c+10&&(f=f.add(r)),d.length?p.upScroll?(l.pageY=l.pageY-o.scroll,d.each(function(l){e(this).scrollTop(e(this).scrollTop()-o.scroll)}),h(l)):function(e){if(p.upScroll)return;p.upScroll=setInterval(function(){p.doc.trigger("mousemove")},50)}():f.length?p.downScroll?(l.pageY=l.pageY+o.scroll,f.each(function(l){e(this).scrollTop(e(this).scrollTop()+o.scroll)}),h(l)):function(e){if(p.downScroll)return;p.downScroll=setInterval(function(){p.doc.trigger("mousemove")},50)}():u(p),p.oElOld=p.oEl,n.el[0].style.visibility="hidden",p.oEl=oEl=function(l,s){if(!document.elementFromPoint)return null;var t=p.isRelEFP;if(null===t){var o,r;(o=p.doc.scrollTop())>0&&(t=null==(r=document.elementFromPoint(0,o+e(window).height()-1))||"HTML"==r.tagName.toUpperCase()),(o=p.doc.scrollLeft())>0&&(t=null==(r=document.elementFromPoint(o+e(window).width()-1,0))||"HTML"==r.tagName.toUpperCase())}t&&(l-=p.doc.scrollLeft(),s-=p.doc.scrollTop());var n=e(document.elementFromPoint(l,s));if(!p.rootEl.el.find(n).length)return null;if(n.is("#s-l-placeholder")||n.is("#s-l-hint"))return null;if(!n.is("li"))return(n=n.closest("li"))[0]?n:null;if(n.is("li"))return n}(l.pageX,l.pageY),n.el[0].style.visibility="visible",function(e,l){var s=l.oEl;if(!s||!l.oElOld)return;var t=s.outerHeight(!1),r=e.pageY-s.offset().top;o.insertZonePlus?14>r?g(e,s,7>r):t-14<r&&C(e,s,t-7<r):5>r?v(e,s):t-5<r&&m(e,s)}(l,p),function(e,l){var s=l.cEl;s.el.css({top:e.pageY-s.xyOffsetDiff.Y-s.mT,left:e.pageX-s.xyOffsetDiff.X-s.mL})}(l,p)}}function f(l){var s=p.cEl,t=e("#s-l-hint",p.rootEl.el),r=i[0].style,n=null,a=!1,h=e("#s-l-hint-wrapper");"block"==r.display&&t.length&&p.isAllowed?(n=t,a=!0):(n=p.placeholderNode,a=!1),offset=n.offset(),s.el.animate({left:offset.left-p.cEl.mL,top:offset.top-p.cEl.mT},250,function(){!function(e){var l=e.el[0].style;e.el.removeClass(o.currElClass+" s-l-current"),l.top="0",l.left="0",l.position="relative",l.width="auto"}(s),n.after(s.el[0]),n[0].style.display="none",r.display="none",t.remove(),h.removeAttr("id").removeClass(o.hintWrapperClass),h.length&&h.prev("div").append(c.clone(!0)),a?p.placeholderNode.slideUp(150,function(){p.placeholderParentLi=p.placeholderNode.parent().is(p.rootEl.el)?null:p.placeholderNode.parent().closest("li"),p.placeholderNode.remove(),T(),o.onChange(s.el),o.complete(s.el),p.isDragged=!1,!1!==o.maxLevels&&(Y(s.el),p.placeholderParentLi&&Y(p.placeholderParentLi))}):(p.placeholderNode.remove(),T(),o.complete(s.el),p.isDragged=!1)}),u(p),p.doc.unbind("mousemove",d).unbind("mouseup",f)}function h(e){p.pY=e.pageY,p.pX=e.pageX,p.cY=e.clientY,p.cX=e.clientX}function u(e){clearInterval(e.upScroll),clearInterval(e.downScroll),e.upScroll=e.downScroll=!1}function v(l,s){if(e("#s-l-hint-wrapper",p.rootEl.el).length&&i.unwrap(),l.pageX-s.offset().left<o.insertZone){if(s.prev("#s-l-placeholder").length||!1!==o.maxLevels&&!x(!1))return void i.css("display","none");s.before(i)}else{var t=s.children(),r=s.children(o.listSelector).first();if(r.children().first().is("#s-l-placeholder")||!1!==o.maxLevels&&!x(!0))return void i.css("display","none");r.length?r.prepend(i):(t.first().after(i),i.wrap(a)),p.oEl&&E(s)}i.css("display","block"),p.isAllowed=o.isAllowed(p.cEl.el,i,i.parents("li").first())}function g(l,s,t){if(e("#s-l-hint-wrapper",p.rootEl.el).length&&i.unwrap(),!t&&l.pageX-s.offset().left>o.insertZone){var r=s.children(),n=s.children(o.listSelector).first();if(n.children().first().is("#s-l-placeholder")||!1!==o.maxLevels&&!x(!0))return void i.css("display","none");n.length?n.prepend(i):(r.first().after(i),i.wrap(a)),p.oEl&&E(s)}else{if(s.prev("#s-l-placeholder").length||!1!==o.maxLevels&&!x(!1))return void i.css("display","none");s.before(i)}i.css("display","block"),p.isAllowed=o.isAllowed(p.cEl.el,i,i.parents("li").first())}function m(l,s){if(e("#s-l-hint-wrapper",p.rootEl.el).length&&i.unwrap(),l.pageX-s.offset().left<o.insertZone){if(s.next("#s-l-placeholder").length||!1!==o.maxLevels&&!x(!1))return void i.css("display","none");s.after(i)}else{var t=s.children(),r=s.children(o.listSelector).last();if(r.children().last().is("#s-l-placeholder")||!1!==o.maxLevels&&!x(!0))return void i.css("display","none");r.length?t.last().append(i):(s.append(i),i.wrap(a)),p.oEl&&E(s)}i.css("display","block"),p.isAllowed=o.isAllowed(p.cEl.el,i,i.parents("li").first())}function C(l,s,t){if(e("#s-l-hint-wrapper",p.rootEl.el).length&&i.unwrap(),!t&&l.pageX-s.offset().left>o.insertZone){var r=s.children(),n=s.children(o.listSelector).last();if(n.children().last().is("#s-l-placeholder")||!1!==o.maxLevels&&!x(!0))return void i.css("display","none");n.length?r.last().append(i):(s.append(i),i.wrap(a)),p.oEl&&E(s)}else{if(s.next("#s-l-placeholder").length||!1!==o.maxLevels&&!x(!1))return void i.css("display","none");s.after(i)}i.css("display","block"),p.isAllowed=o.isAllowed(p.cEl.el,i,i.parents("li").first())}function E(e){e.removeClass("s-l-closed").addClass("s-l-open"),e.children(o.listSelector).css("display","block");var l=e.children("div").children(".s-l-opener").first();"html"==o.opener.as?l.html(o.opener.close):"class"==o.opener.as&&l.addClass(o.opener.close).removeClass(o.opener.open)}function w(e){e.removeClass("s-l-open").addClass("s-l-closed"),e.children(o.listSelector).css("display","none");var l=e.children("div").children(".s-l-opener").first();"html"==o.opener.as?l.html(o.opener.open):"class"==o.opener.as&&l.addClass(o.opener.open).removeClass(o.opener.close)}function y(l){var s=0,t=l.children(o.listSelector);if(t.length){s++;var r=0,n=0;t.find("li").each(function(l){n=y(e(this)),r<n&&(r=n)}),r&&(s+=r)}return s}function b(e,l){e.data("inside-levels",l)}function L(e){for(var l=0,s=p.rootEl.el,t=e.closest(o.listSelector);!t.is(s);)l++,t=t.parent().closest(o.listSelector);return l}function S(e,l){e.data("upper-levels",l)}function x(e){var l=p.cEl.el.data("inside-levels"),s=p.oEl.data("upper-levels");return o.maxLevels>s+l+(e?1:0)}function Y(l){var s=p.rootEl.el,t=l.parent(o.listSelector);b(l,y(l)),S(l,L(l));var r=0;for(l.find("li").each(function(){var l=e(this);b(l,y(l)),S(l,L(l))});!t.is(s)&&r<50;){b(l=t.parent("li"),y(l)),t=l.parent(o.listSelector),r++}}function T(){e(o.listSelector,p.rootEl.el).each(function(l){e(this).children().length||(e(this).prev("div").children(".s-l-opener").first().remove(),e(this).remove())})}},e.fn.sortableListsToArray=function(l,s){l=l||[];var t=0;return this.children("li").each(function(){var o=e(this),r={},n=o.attr("id");if(!n)throw console.log(o),"Previous item in console.log has no id. It is necessary to create the array.";r.id=n,r.parentId=s,r.value=o.data("value"),r.order=t,l.push(r),o.children("ul,ol").sortableListsToArray(l,n),t++}),l},e.fn.sortableListsToHierarchy=function(){var l=[],s=0;return e(this).children("li").each(function(){var t=e(this),o={},r=t.attr("id");if(!r)throw console.log(t),"Previous item in console.log has no id. It is necessary to create the array.";o.id=r,o.value=t.data("value"),o.order=s,l.push(o),o.children=t.children("ul,ol").sortableListsToHierarchy(),s++}),l},e.fn.sortableListsToString=function(l,s){return l=l||[],s=s||"no-parent",e(this).children("li").each(function(){var t=e(this),o=t.attr("id"),r=o?o.match(/(.+)[-=_](.+)/):null;if(!r)throw console.log(t),"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string.";l.push(r[1]+"["+r[2]+"]="+s),e(this).children("ul,ol").sortableListsToString(l,r[2])}),l.join("&")}}(jQuery);