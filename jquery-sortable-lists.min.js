(function(a){a.fn.sortableLists=function(k){var A=a("body").css("position","relative"),r={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(A.css("margin-top")),left:0-parseInt(A.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:false,open:"",close:"",openerCss:{"float":"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:false,scroll:20,ignoreClass:"",isAllowed:function(E,G,F){return true},onDragStart:function(F,E){return true},onChange:function(E){return true},complete:function(E){return true}},y=a.extend(true,{},r,k),n=a("<"+y.listSelector+" />").prependTo(A).attr("id","sortableListsBase").css(y.baseCss).addClass(y.listsClass+" "+y.baseClass),o=a("<li />").attr("id","sortableListsPlaceholder").css(y.placeholderCss).addClass(y.placeholderClass),t=a("<li />").attr("id","sortableListsHint").css(y.hintCss).addClass(y.hintClass),i=a("<"+y.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(y.listsClass+" "+y.hintWrapperClass).css(y.listsCss).css(y.hintWrapperCss),v=a("<span />").addClass("sortableListsOpener "+y.opener.openerClass).css(y.opener.openerCss).on("mousedown",function(F){var E=a(this).closest("li");if(E.hasClass("sortableListsClosed")){s(E)}else{u(E)}return false});if(y.opener.as=="class"){v.addClass(y.opener.close)}else{if(y.opener.as=="html"){v.html(y.opener.close)}else{v.css("background-image","url("+y.opener.close+")");console.error("jQuerySortableLists opener as background image is deprecated. In version 2.0.0 it will be removed. Use html instead please.")}}var m={isDragged:false,isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:false,downScroll:false,pX:0,pY:0,cX:0,cY:0,isAllowed:true,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:a(document),win:a(window)};if(y.opener.active){if(!y.opener.open){throw"Opener.open value is not defined. It should be valid url, html or css class."}if(!y.opener.close){throw"Opener.close value is not defined. It should be valid url, html or css class."}a(this).find("li").each(function(){var E=a(this);if(E.children(y.listSelector).length){v.clone(true).prependTo(E.children("div").first());if(!E.hasClass("sortableListsOpen")){u(E)}else{s(E)}}})}return this.on("mousedown",function(H){var G=a(H.target);if(m.isDragged!==false||(y.ignoreClass&&G.hasClass(y.ignoreClass))){return}H.preventDefault();var F=G.closest("li"),E=a(this);if(F[0]){y.onDragStart(H,F);e(H,F,E)}});function e(K,G,F){m.isDragged=true;var M=parseInt(G.css("margin-top")),I=parseInt(G.css("margin-bottom")),E=parseInt(G.css("margin-left")),N=parseInt(G.css("margin-right")),L=G.offset(),J=G.innerHeight();m.rootEl={el:F,offset:F.offset(),rootElClass:F.attr("class")};m.cEl={el:G,mT:M,mL:E,mB:I,mR:N,offset:L};m.cEl.xyOffsetDiff={X:K.pageX-m.cEl.offset.left,Y:K.pageY-m.cEl.offset.top};m.cEl.el.addClass("sortableListsCurrent "+y.currElClass);G.before(o);var H=m.placeholderNode=a("#sortableListsPlaceholder");G.css({width:G.width(),position:"absolute",top:L.top-M,left:L.left-E}).prependTo(n);H.css({display:"block",height:J});t.css("height",J);m.doc.on("mousemove",z).on("mouseup",B)}function z(H){if(m.isDragged){var E=m.cEl,G=m.doc,F=m.win;if(!H.pageX){f(H)}if(G.scrollTop()>m.rootEl.offset.top-10&&H.clientY<50){if(!m.upScroll){w(H)}else{H.pageY=H.pageY-y.scroll;a("html, body").each(function(I){a(this).scrollTop(a(this).scrollTop()-y.scroll)});h(H)}}else{if(G.scrollTop()+F.height()<m.rootEl.offset.top+m.rootEl.el.outerHeight(false)+10&&F.height()-H.clientY<50){if(!m.downScroll){p(H)}else{H.pageY=H.pageY+y.scroll;a("html, body").each(function(I){a(this).scrollTop(a(this).scrollTop()+y.scroll)});h(H)}}else{l(m)}}m.oElOld=m.oEl;E.el[0].style.visibility="hidden";m.oEl=oEl=q(H.pageX,H.pageY);E.el[0].style.visibility="visible";g(H,m);c(H,m)}}function B(I){var H=m.cEl,E=a("#sortableListsHint",m.rootEl.el),K=t[0].style,J=null,G=false,F=a("#sortableListsHintWrapper");if(K.display=="block"&&E.length&&m.isAllowed){J=E;G=true}else{J=m.placeholderNode;G=false}offset=J.offset();H.el.animate({left:offset.left-m.cEl.mL,top:offset.top-m.cEl.mT},250,function(){b(H);J.after(H.el[0]);J[0].style.display="none";K.display="none";E.remove();F.removeAttr("id").removeClass(y.hintWrapperClass);if(F.length){F.prev("div").append(v.clone(true))}if(G){m.placeholderNode.slideUp(150,function(){m.placeholderNode.remove();C();y.onChange(H.el);y.complete(H.el);m.isDragged=false})}else{m.placeholderNode.remove();C();y.complete(H.el);m.isDragged=false}});l(m);m.doc.unbind("mousemove",z).unbind("mouseup",B)}function w(E){if(m.upScroll){return}m.upScroll=setInterval(function(){m.doc.trigger("mousemove")},50)}function p(E){if(m.downScroll){return}m.downScroll=setInterval(function(){m.doc.trigger("mousemove")},50)}function h(E){m.pY=E.pageY;m.pX=E.pageX;m.cY=E.clientY;m.cX=E.clientX}function f(E){E.pageY=m.pY;E.pageX=m.pX;E.clientY=m.cY;E.clientX=m.cX}function l(E){clearInterval(E.upScroll);clearInterval(E.downScroll);E.upScroll=E.downScroll=false}function c(G,F){var E=F.cEl;E.el.css({top:G.pageY-E.xyOffsetDiff.Y-E.mT,left:G.pageX-E.xyOffsetDiff.X-E.mL})}function q(E,J){if(!document.elementFromPoint){return null}var I=m.isRelEFP;if(I===null){var H,F;if((H=m.doc.scrollTop())>0){I=((F=document.elementFromPoint(0,H+a(window).height()-1))==null||F.tagName.toUpperCase()=="HTML")}if((H=m.doc.scrollLeft())>0){I=((F=document.elementFromPoint(H+a(window).width()-1,0))==null||F.tagName.toUpperCase()=="HTML")}}if(I){E-=m.doc.scrollLeft();J-=m.doc.scrollTop()}var G=a(document.elementFromPoint(E,J));if(!m.rootEl.el.find(G).length){return null}else{if(G.is("#sortableListsPlaceholder")||G.is("#sortableListsHint")){return null}else{if(!G.is("li")){G=G.closest("li");return G[0]?G:null}else{if(G.is("li")){return G}}}}}function g(I,H){var E=H.oEl;if(!E||!H.oElOld){return}var G=E.outerHeight(false),F=I.pageY-E.offset().top;if(y.insertZonePlus){if(14>F){d(I,E,7>F)}else{if(G-14<F){x(I,E,G-7<F)}}}else{if(5>F){j(I,E)}else{if(G-5<F){D(I,E)}}}}function j(H,E){if(a("#sortableListsHintWrapper",m.rootEl.el).length){t.unwrap()}if(H.pageX-E.offset().left<y.insertZone){if(E.prev("#sortableListsPlaceholder").length){t.css("display","none");return}E.before(t)}else{var F=E.children(),G=E.children(y.listSelector).first();if(G.children().first().is("#sortableListsPlaceholder")){t.css("display","none");return}if(!G.length){F.first().after(t);t.wrap(i)}else{G.prepend(t)}if(m.oEl){s(E)}}t.css("display","block");m.isAllowed=y.isAllowed(m.cEl.el,t,t.parents("li").first())}function d(I,E,H){if(a("#sortableListsHintWrapper",m.rootEl.el).length){t.unwrap()}if(!H&&I.pageX-E.offset().left>y.insertZone){var F=E.children(),G=E.children(y.listSelector).first();if(G.children().first().is("#sortableListsPlaceholder")){t.css("display","none");return}if(!G.length){F.first().after(t);t.wrap(i)}else{G.prepend(t)}if(m.oEl){s(E)}}else{if(E.prev("#sortableListsPlaceholder").length){t.css("display","none");return}E.before(t)}t.css("display","block");m.isAllowed=y.isAllowed(m.cEl.el,t,t.parents("li").first())}function D(H,E){if(a("#sortableListsHintWrapper",m.rootEl.el).length){t.unwrap()}if(H.pageX-E.offset().left<y.insertZone){if(E.next("#sortableListsPlaceholder").length){t.css("display","none");return}E.after(t)}else{var F=E.children(),G=E.children(y.listSelector).last();if(G.children().last().is("#sortableListsPlaceholder")){t.css("display","none");return}if(G.length){F.last().append(t)}else{E.append(t);t.wrap(i)}if(m.oEl){s(E)}}t.css("display","block");m.isAllowed=y.isAllowed(m.cEl.el,t,t.parents("li").first())}function x(I,E,H){if(a("#sortableListsHintWrapper",m.rootEl.el).length){t.unwrap()}if(!H&&I.pageX-E.offset().left>y.insertZone){var F=E.children(),G=E.children(y.listSelector).last();if(G.children().last().is("#sortableListsPlaceholder")){t.css("display","none");return}if(G.length){F.last().append(t)}else{E.append(t);t.wrap(i)}if(m.oEl){s(E)}}else{if(E.next("#sortableListsPlaceholder").length){t.css("display","none");return}E.after(t)}t.css("display","block");m.isAllowed=y.isAllowed(m.cEl.el,t,t.parents("li").first())}function s(E){E.removeClass("sortableListsClosed").addClass("sortableListsOpen");E.children(y.listSelector).css("display","block");var F=E.children("div").children(".sortableListsOpener").first();if(y.opener.as=="html"){F.html(y.opener.close)}else{if(y.opener.as=="class"){F.addClass(y.opener.close).removeClass(y.opener.open)}else{F.css("background-image","url("+y.opener.close+")")}}}function u(E){E.removeClass("sortableListsOpen").addClass("sortableListsClosed");E.children(y.listSelector).css("display","none");var F=E.children("div").children(".sortableListsOpener").first();if(y.opener.as=="html"){F.html(y.opener.open)}else{if(y.opener.as=="class"){F.addClass(y.opener.open).removeClass(y.opener.close)}else{F.css("background-image","url("+y.opener.open+")")}}}function b(E){var F=E.el[0].style;E.el.removeClass(y.currElClass+" sortableListsCurrent");F.top="0";F.left="0";F.position="relative";F.width="auto"}function C(){a(y.listSelector,m.rootEl.el).each(function(E){if(!a(this).children().length){a(this).prev("div").children(".sortableListsOpener").first().remove();a(this).remove()}})}};a.fn.sortableListsToArray=function(c,d){c=c||[];var b=0;this.children("li").each(function(){var e=a(this),f={},g=e.attr("id");if(!g){console.log(e);throw"Previous item in console.log has no id. It is necessary to create the array."}f.id=g;f.parentId=d;f.value=e.data("value");f.order=b;c.push(f);e.children("ul,ol").sortableListsToArray(c,g);b++});return c};a.fn.sortableListsToHierarchy=function(){var c=[],b=0;a(this).children("li").each(function(){var d=a(this),e={},f=d.attr("id");if(!f){console.log(d);throw"Previous item in console.log has no id. It is necessary to create the array."}e.id=f;e.value=d.data("value");e.order=b;c.push(e);e.children=d.children("ul,ol").sortableListsToHierarchy();b++});return c};a.fn.sortableListsToString=function(b,c){b=b||[];c=c||"no-parent";a(this).children("li").each(function(){var d=a(this),f=d.attr("id"),e=f?f.match(/(.+)[-=_](.+)/):null;if(!e){console.log(d);throw"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string."}b.push(e[1]+"["+e[2]+"]="+c);a(this).children("ul,ol").sortableListsToString(b,e[2])});return b.join("&")}}(jQuery));